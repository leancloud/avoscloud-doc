<!--# åšä¸ªé¤å…ç®¡ç†ç³»ç»Ÿæ²¡ç”¨ LeanStorageï¼Œè¿™ä½ç¨‹åºå‘˜è¢«è€æ¿å¼€é™¤äº†-->

# LeanStorage æ¡ˆä¾‹åˆ†æ - é¤å…ç®¡ç†ç³»ç»Ÿè®¾è®¡

## è¿™ç¯‡æ•™ç¨‹è®²ä»€ä¹ˆï¼Ÿ
- è¯¦è§£å¦‚ä½•è®¾è®¡ä¸€ä¸ªé¤å…-åº§ä½-é¢„è®¢ç®¡ç†ç³»ç»Ÿåœ¨ LeanCloud å¦‚ä½•å¿«é€Ÿçš„å¼€å‘
- åœ¨æ²¡æœ‰ mongodb ç›¸å…³çŸ¥è¯†å‚¨å¤‡çš„æƒ…å†µä¸‹å¦‚ä½•ä½¿ç”¨ä¼ ç»Ÿçš„ SQL è¯­å¥è¿…é€Ÿåœ°ä½¿ç”¨ LeanCloud å­˜å‚¨
- åœ¨è¡¨è®¾è®¡çš„æ—¶å€™å¦‚ä½•åˆç†çš„ä½¿ç”¨ Relationï¼ŒPoninter å’Œè‡ªå»ºä¸­é—´è¡¨

## è¯»å®Œè¿™ç¯‡æ•™ç¨‹ä¹‹åèƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ
å¦‚ä¸‹å†…å®¹å¯¹ä¸ªäººæƒ…å†µä¸åŒå¯èƒ½æœ‰æ‰€åå·®ï¼Œä½†æ˜¯å¤§è‡´å¦‚æ­¤ã€‚

å‡è®¾æ¯ä¸€é¡¹æŠ€èƒ½ä»¥ 10 æ˜Ÿè®¡ç®—ï¼Œ10 æ˜Ÿå¯ä»¥ç§°ä¸ºè¯¥æŠ€èƒ½çš„ä¸šç•Œé¡¶å°–æ°´å¹³

- mongodb ä½¿ç”¨æ°´å¹³æå‡ï¼š1 æ˜Ÿ
- é€»è¾‘å»ºæ¨¡èƒ½åŠ›æå‡ï¼š2 æ˜Ÿ
- ç¼–ç¨‹æ°´å¹³æå‡ï¼š2 æ˜Ÿ
- LeanCloud çŸ¥è¯†å‚¨å¤‡å¢åŠ ï¼š4 æ˜Ÿ


## é¡¹ç›®èƒŒæ™¯ä»‹ç»
æœ¬æ–‡ç¼˜èµ·ä¸€ä¸ªç”¨æˆ·åœ¨ç¤¾åŒºçš„è®¨è®ºï¼š

æˆ‘æƒ³è®¾è®¡ä¸€ä¸ªè¡¨ç»“æ„ï¼Œèƒ½å®ç°å¦‚ä¸‹éœ€æ±‚ï¼š

- å±•ç°é¤å…åˆ—è¡¨
- æ¯ä¸ªé¤å…éœ€è¦ç®¡ç†é¤å…å†…éƒ¨çš„åº§ä½
- æ¯ä¸ªåº§ä½åœ¨æ¯å¤©çš„æŸä¸€ä¸ªæ—¶æ®µå¯èƒ½ä¼šè¢«é¢„å®šï¼Œæˆ‘éœ€è¦ç®¡ç†è¿™äº›é¢„å®š
- ç»™è€æ¿å±•ç°æ¯ä¸€ä¸ªé¤å…æŸä¸€ä¸ªæ—¶æ®µçš„é¢„è®¢ç‡
- ç»™è€æ¿å±•ç°æŸä¸€ä¸ªé¤å…çš„æŸä¸€ä¸ªåº§ä½çš„ç¿»æ¡Œç‡ï¼ˆè¿™ä¸ªä½ç½®å¯èƒ½é çª—æˆ·ä¹Ÿå¯èƒ½åº§ä½æœ¬èº«çš„è®¾è®¡å¾ˆå—æ¬¢è¿ï¼‰


ä¸€å¼€å§‹æˆ‘ä»¬åªæ˜¯è®¨è®ºï¼Œåæ¥æˆ‘ä»¬è·Ÿè¿™ä¸ªå®¢æˆ·ä¹Ÿå¤šæ¬¡æ²Ÿé€šæœ€ååœ¨ä¸æ–­çš„æ¢è®¨ä¸‹æˆ‘ä»¬å‘ç°å…¶ä¸­å¾ˆå¤šè®¾è®¡çš„æ€è·¯é’ˆå¯¹å…¶ä»–ç³»ç»Ÿæ˜¯é€‚ç”¨çš„ï¼Œå› æ­¤æˆ‘ä»¬ç‰¹åˆ«æç‚¼å‡ºä¸€äº›ç²¾ååˆ†äº«ç»™æ‰€æœ‰ LeanCloud å¼€å‘è€…ï¼Œå¸Œæœ›å‡å°‘å¤§å®¶ã€Œæ‰å‘ã€æƒ…å†µçš„å‘ç”Ÿï¼Œé¦–å…ˆæˆ‘ä»¬æ¥é’ˆå¯¹ä¸Šè¿°éœ€æ±‚ä¸€ä¸ªä¸€ä¸ªæ‹†è§£ï¼Œé€æ­¥å®ç°è¿™ä¸ªç³»ç»Ÿé‡Œé¢çš„è¡¨ç»“æ„è®¾è®¡ã€‚


## å±•ç°é¤å…åˆ—è¡¨(Restaurant)

é¦–å…ˆæˆ‘ä»¬ç®€åŒ–é¤å…çš„å­—æ®µï¼Œæˆ‘ä»¬å…ˆä¿å­˜ä¸€ä¸‹åŸºæœ¬å­—æ®µï¼ˆåæ–‡ä¼šæ ¹æ®éœ€æ±‚è¡¥å……æˆ–è€…ä¿®æ”¹å­—æ®µï¼‰ï¼š

id|name(é¤å…åç§°:string)
--|--
r1|å¿…èƒœå®¢
r2|éº¦å½“åŠ³
r3|è‚¯å¾·åŸº


ç„¶åè°ƒç”¨ SDK çš„ä»£ç åˆ›å»ºå®ƒä»¬:

```js
'use strict';
var AV = require('leancloud-storage');

exports.newRestaurant = function newRestaurant(restaurantData) {
    let name = restaurantData.name || '';
    if (name == '') {
        throw new Error('é¤å…å¿…é¡»å¾—æœ‰ä¸ªåå­—å§ï¼ŒğŸ˜œ');
    }
    let restaurant = new AV.Object('Restaurant');
    restaurant.set('name', name);
    return restaurant.save();
}

// è°ƒç”¨ä»£ç å¦‚ä¸‹:
let restaurantData = {
    name: 'å¿…èƒœå®¢',
};
newRestaurant(restaurantData).then(result => {
    console.log(result.id);
});
```

## åº§ä½(Seat)

id|under(å½’å±é¤å…:Pointer)|capacity(åº§ä½å®¹é‡:number)
--|--|--
s1|r1|2
s2|r1|3
s3|r1|4
s4|r2|2
s5|r2|2
s6|r3|5

```js
//filename:booking.js
exports.newSeat = function newSeat(seatData) {
    let restaurant = seatData.restaurant;
    if (restaurant == undefined) throw new Error('ä¸€ä¸ªåº§ä½å¿…é¡»å±äºä¸€ä¸ªé¤å…å•Šï¼Œäº² ğŸš');
    let capacity = seatData.capacity || 1;
    let seat = new AV.Object('Seat');

    seat.set('under', restaurant);
    seat.set('capacity', capacity);

    return seat.save();
}

// è°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š
let restaurantData = {
    name: utils.randomString(),
};
newRestaurant(restaurantData).then(restaurant => {
    let seatData = {
        capacity: 5,
        restaurant: restaurant
    };
    return newSeat(seatData);
}).then(result => {
    // ä¿å­˜æˆåŠŸ
}).catch(error => {
    console.log(error);
});
```

## é¢„è®¢è¡¨(Bookings)

objectId|seat(åº§ä½:)|from(é¢„è®¢èµ·å§‹æ—¶é—´:Date)|to(é¢„è®¢ç»“æŸæ—¶é—´:Date)
--|--|--|--
s1|r1|2017-02-01 18:00|2017-02-01 19:00
s2|r1|2017-02-02 15:00|2017-02-02 16:00
s3|r1|2017-02-02 15:00|2017-02-01 16:00
s4|r2|2017-02-01 18:00|2017-02-01 19:00
s5|r2|2017-02-01 18:00|2017-02-01 19:00
s6|r3|2017-02-01 18:00|2017-02-01 19:00


```js
//filename:booking.js
exports.newBooking = function newBooking(bookingtData) {
    let seat = bookingtData.seat;
    if(typeof seat === 'undefined') throw new Error('è®¢åº§ä½çš„æ—¶å€™ä¸€å®šè¦æŒ‡å®šåº§ä½...');
    let from = bookingtData.from;
    if(typeof from === 'undefined') throw new Error('è®¢åº§ä½çš„æ—¶å€™ä¸€å®šè¦æŒ‡å®šæŒ‡å®šé¢„è®¢èµ·å§‹æ—¶é—´'); 
    let to = bookingtData.to;
    if(typeof to === 'undefined') throw new Error('è®¢åº§ä½çš„æ—¶å€™ä¸€å®šè¦æŒ‡å®šæŒ‡å®šç»“æŸå°±é¤çš„æ—¶é—´');

    let booking = new AV.Object('Booking');
    booking.set('seat',seat);
    booking.set('from',from);
    booking.set('to',to);

    return booking.save();
}
```

## æŸ¥è¯¢æŸä¸€ä¸ªé¤å…çš„æŸä¸€ä¸ªæ—¶æ®µçš„é¢„è®¢æƒ…å†µ

é¦–å…ˆæˆ‘ä»¬é’ˆå¯¹ä¸Šè¿°çš„éœ€æ±‚æ‹†è§£æŸ¥è¯¢æ¡ä»¶ï¼š

1. æŸ¥è¯¢æŸä¸€ä¸ªé¤å…é‡Œé¢é‡Œé¢æ‰€æœ‰çš„åº§ä½
2. æŸ¥è¯¢ä¸€ä¸ªåº§ä½åœ¨æŸä¸€ä¸ªæ—¶æ®µçš„é¢„è®¢æƒ…å†µ
3. æŸ¥è¯¢ä¸€äº›åº§ä½åœ¨æŸä¸€ä¸ªæ—¶æ®µçš„é¢„è®¢æƒ…å†µ

æ‹†è§£ä¹‹åï¼Œæˆ‘ä»¬æ¥ç”¨ä»£ç é€æ­¥å®ç°ã€‚

### æŸ¥è¯¢æŸä¸€ä¸ªé¤å…é‡Œé¢é‡Œé¢æ‰€æœ‰çš„åº§ä½

å‡è®¾æ•°æ®åº“å­˜åœ¨å¦‚ä¸‹æ•°æ®ï¼š

objectId|name|createdAt|updatedAt
--|--|--|--
58edc5cea0bb9f006a4d57eb|å¿…èƒœå®¢|2017-04-12 14:14:38|2017-04-17 15:36:35
58ee366644d9040057784276|éº¦å½“åŠ³|2017-04-12 22:15:02|2017-04-13 10:51:38
58ee0124a0bb9f006a4f3f40|è‚¯å¾·åŸº|2017-04-12 18:27:48|2017-04-13 10:51:35







